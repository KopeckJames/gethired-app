import{r,j as e,u as J}from"./components-9TVjVNdt.js";import{C as E}from"./Card-Bc0Lcq-1.js";import{B as c}from"./Button-CDHjtM4L.js";import{S as R}from"./Select-B3oI0161.js";import{M}from"./Modal-Bz2tyEF1.js";function K({resumes:h,jobDescriptions:p,onUpdate:d}){const[l,g]=r.useState(""),[o,k]=r.useState(""),[i,b]=r.useState(null),[u,D]=r.useState(null),[F,N]=r.useState(!1),[A,v]=r.useState(!1),[f,w]=r.useState(!1),[S,j]=r.useState(!1),[z,n]=r.useState(null),C=async s=>{const a=s||l;if(!a||!o){n("Please select both a resume and a job description");return}N(!0),n(null);try{const t=await fetch("/api/resume-analysis",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({resumeId:a,jobDescriptionId:o})}),m=await t.json();if(!t.ok)throw new Error(m.error||"Failed to analyze resume");b(m.analysis)}catch(t){n(t instanceof Error?t.message:"Failed to analyze resume")}finally{N(!1)}},I=async()=>{if(!l||!o){n("Please select both a resume and a job description");return}v(!0),n(null);try{const s=await fetch("/api/resume-analysis/optimize",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({resumeId:l,jobDescriptionId:o})}),a=await s.json();if(!s.ok)throw new Error(a.error||"Failed to optimize resume");D(a.optimization);const t=a.optimization.formattedDocumentId;g(t),d==null||d(),await C(t),j(!0)}catch(s){n(s instanceof Error?s.message:"Failed to optimize resume")}finally{v(!1)}},y=async s=>{var a;if(!l){n("Please select a resume");return}w(!0),n(null);try{const t=await fetch("/api/documents/export",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({documentId:l,format:s,score:i==null?void 0:i.score,analysis:i?{keywordsFound:i.analysis.keywordsFound,missingKeywords:i.analysis.missingKeywords,recommendations:i.recommendations,summary:i.summary}:void 0})});if(!t.ok){const T=await t.json();throw new Error(T.error||"Failed to export resume")}const m=t.headers.get("Content-Disposition"),L=((a=m==null?void 0:m.split("filename=")[1])==null?void 0:a.replace(/"/g,""))||`resume.${s}`,P=await t.blob(),O=window.URL.createObjectURL(P),x=document.createElement("a");x.href=O,x.download=L,document.body.appendChild(x),x.click(),window.URL.revokeObjectURL(O),document.body.removeChild(x)}catch(t){n(t instanceof Error?t.message:"Failed to export resume")}finally{w(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{variant:"bordered",className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Resume Analysis"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(R,{label:"Select Resume",value:l,onChange:s=>{g(s.target.value),b(null)},options:[{value:"",label:"Select a resume..."},...h.map(s=>({value:s.id,label:s.name}))]}),e.jsx(R,{label:"Select Job Description",value:o,onChange:s=>{k(s.target.value),b(null)},options:[{value:"",label:"Select a job description..."},...p.map(s=>({value:s.id,label:s.name}))]})]}),z&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:z}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-4",children:[e.jsx(c,{onClick:()=>C(),isLoading:F,disabled:!l||!o,children:"Analyze Resume"}),i&&i.score<90&&e.jsx(c,{onClick:I,isLoading:A,variant:"secondary",disabled:!l||!o,children:"Optimize Resume"}),l&&i&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:()=>y("txt"),isLoading:f,variant:"secondary",disabled:!l,children:"Export TXT"}),e.jsx(c,{onClick:()=>y("pdf"),isLoading:f,variant:"secondary",disabled:!l,children:"Export PDF"}),e.jsx(c,{onClick:()=>y("docx"),isLoading:f,variant:"secondary",disabled:!l,children:"Export DOCX"})]})]})]}),i&&e.jsx(E,{variant:"bordered",className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Overall Score"}),e.jsxs("div",{className:`text-3xl font-bold ${i.score>=90?"text-green-600":"text-blue-600"}`,children:[i.score,"%"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Score Breakdown"}),e.jsx("div",{className:"space-y-2",children:Object.entries(i.criteriaScores).map(([s,a])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"capitalize",children:s.replace(/([A-Z])/g," $1").trim()}),e.jsxs("span",{className:"font-semibold",children:[a,"%"]})]},s))})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Keywords Found"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.analysis.keywordsFound.map((s,a)=>e.jsx("li",{className:"text-green-600",children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Missing Keywords"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.analysis.missingKeywords.map((s,a)=>e.jsx("li",{className:"text-red-600",children:s},a))})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Strengths"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.analysis.strengths.map((s,a)=>e.jsx("li",{className:"text-green-600",children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Weaknesses"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.analysis.weaknesses.map((s,a)=>e.jsx("li",{className:"text-red-600",children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Recommendations"}),e.jsx("ul",{className:"list-disc list-inside space-y-2",children:i.recommendations.map((s,a)=>e.jsx("li",{children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Summary"}),e.jsx("p",{className:"text-gray-700",children:i.summary})]})]})}),S&&u&&e.jsx(M,{isOpen:S,onClose:()=>j(!1),title:"Optimized Resume",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Expected Score"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:[u.expectedScore,"%"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Changes Made"}),e.jsx("ul",{className:"list-disc list-inside space-y-2",children:u.changes.map((s,a)=>e.jsx("li",{children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Optimized Content"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-96 overflow-y-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm",children:u.optimizedContent})})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx(c,{variant:"secondary",onClick:()=>j(!1),children:"Close"}),e.jsx(c,{onClick:()=>{j(!1),y("docx")},children:"Export DOCX"})]})]})})]})}function Z(){const{resumes:h,jobDescriptions:p,error:d}=J();return d?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),e.jsx("p",{className:"text-gray-600",children:d})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Resume Analysis"}),h.length===0||p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Documents Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please upload at least one resume and one job description to use this feature."}),e.jsx("a",{href:"/documents",className:"text-blue-600 hover:text-blue-700",children:"Go to Documents â†’"})]}):e.jsx(K,{resumes:h,jobDescriptions:p})]})}export{Z as default};
