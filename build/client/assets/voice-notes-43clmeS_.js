import{r as a,j as e,u as I}from"./components-9TVjVNdt.js";import{B as M}from"./Button-CDHjtM4L.js";import{C as x}from"./Card-Bc0Lcq-1.js";import{S as N}from"./Select-B3oI0161.js";import{T as y}from"./Textarea-Aa5uwp8P.js";import{F as q}from"./MicrophoneIcon-At7u6jEd.js";function H({title:l,titleId:c,...t},m){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":c},t),l?a.createElement("title",{id:c},l):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const O=a.forwardRef(H);function B({resumes:l,jobDescriptions:c}){const[t,m]=a.useState(!1),[u,E]=a.useState(""),[p,R]=a.useState(""),[S,f]=a.useState(""),[P,g]=a.useState(""),[h,o]=a.useState(null),[k,J]=a.useState(!1),[j,w]=a.useState(!0),d=a.useRef(null),b=a.useRef([]),v=a.useRef(null);a.useEffect(()=>{if(!navigator.mediaDevices||!window.MediaRecorder){w(!1),o("Your browser doesn't support audio recording. Please use a modern browser like Chrome, Firefox, or Edge.");return}if(window.location.protocol!=="https:"&&window.location.hostname!=="localhost"){w(!1),o("Audio recording requires a secure connection (HTTPS). Please access this site over HTTPS.");return}},[]),a.useEffect(()=>()=>{v.current&&clearTimeout(v.current),d.current&&t&&(d.current.stop(),d.current.stream.getTracks().forEach(s=>s.stop()))},[t]);const T=async s=>{const r=new FormData;r.append("audio",s),r.append("mode","respond"),r.append("resumeId",u),r.append("jobDescriptionId",p);try{const n=await fetch("/api/voice-notes",{method:"POST",body:r,credentials:"include"});if(!n.ok)throw new Error("Failed to process audio");const i=await n.json();if(i.error)throw new Error(i.error);f(A=>A+" "+i.transcription),i.response&&g(i.response)}catch(n){console.error("Error processing audio:",n),o(n instanceof Error?n.message:"Failed to process audio")}},C=async()=>{try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(r=>r.stop()),!0}catch(s){return s instanceof Error&&(s.name==="NotAllowedError"||s.name==="PermissionDeniedError"?o("Microphone access was denied. Please allow microphone access in your browser settings and try again."):s.name==="NotFoundError"||s.name==="DevicesNotFoundError"?o("No microphone found. Please connect a microphone and try again."):o("Error accessing microphone: "+s.message)),!1}},D=async()=>{if(!u||!p){o("Please select both a resume and job description");return}if(!(!j||!await C()))try{o(null);const r=await navigator.mediaDevices.getUserMedia({audio:!0}),n=new MediaRecorder(r,{mimeType:MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4"});d.current=n,b.current=[],n.ondataavailable=async i=>{i.data.size>0&&(b.current.push(i.data),await T(i.data))},n.start(3e3),m(!0),f(""),g("")}catch(r){console.error("Error accessing microphone:",r),r instanceof Error?r.name==="NotAllowedError"||r.name==="PermissionDeniedError"?o("Microphone access was denied. Please allow microphone access in your browser settings and try again."):r.name==="NotFoundError"||r.name==="DevicesNotFoundError"?o("No microphone found. Please connect a microphone and try again."):o("Error accessing microphone: "+r.message):o("Could not access microphone. Please check permissions.")}},F=()=>{d.current&&t&&(d.current.stop(),d.current.stream.getTracks().forEach(s=>s.stop()),m(!1))};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(x,{variant:"bordered",className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Interview Practice"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(N,{label:"Select Resume",value:u,onChange:s=>E(s.target.value),options:[{value:"",label:"Select a resume..."},...l.map(s=>({value:s.id,label:s.name}))],disabled:t}),e.jsx(N,{label:"Select Job Description",value:p,onChange:s=>R(s.target.value),options:[{value:"",label:"Select a job description..."},...c.map(s=>({value:s.id,label:s.name}))],disabled:t})]}),h&&e.jsxs("div",{className:"text-red-600 text-sm bg-red-50 p-3 rounded-md",children:[h,h.includes("microphone access")&&e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"How to fix:"}),e.jsxs("ol",{className:"list-decimal list-inside mt-1",children:[e.jsx("li",{children:"Click the camera/microphone icon in your browser's address bar"}),e.jsx("li",{children:'Select "Allow" for microphone access'}),e.jsx("li",{children:"Refresh the page and try again"})]})]})]}),e.jsx("div",{className:"flex gap-4",children:e.jsx(M,{onClick:t?F:D,variant:t?"outline":"primary",className:"flex items-center gap-2",disabled:!j||!u||!p||k,children:t?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-5 w-5"}),"Stop Recording"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-5 w-5"}),"Start Recording"]})})})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(x,{variant:"bordered",className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Question Transcription"}),e.jsx(y,{value:S,onChange:()=>{},placeholder:"Question transcription will appear here...",textareaClassName:"h-[200px]",readOnly:!0})]}),e.jsxs(x,{variant:"bordered",className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"AI Response"}),e.jsx(y,{value:P,onChange:()=>{},placeholder:"AI response will appear here...",textareaClassName:"h-[200px]",readOnly:!0})]})]})]})}function Y(){const{error:l,resumes:c,jobDescriptions:t}=I();return l?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),e.jsx("p",{className:"text-gray-600",children:l})]})}):c.length===0||t.length===0?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Interview Practice"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c.length===0?"Please upload a resume to use this feature.":"Please upload a job description to use this feature."})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Interview Practice"}),e.jsx("p",{className:"text-gray-600",children:"Practice your interview skills with AI-powered feedback. Select a resume and job description, then start speaking to receive real-time transcription and contextual responses."})]}),e.jsx(B,{resumes:c,jobDescriptions:t}),e.jsxs("div",{className:"mt-8 text-sm text-gray-500",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Tips:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Speak clearly and at a normal pace"}),e.jsx("li",{children:"Use a quiet environment for better transcription"}),e.jsx("li",{children:"Wait for the AI response before asking your next question"}),e.jsx("li",{children:"Try to ask specific, job-related questions"})]})]})]})}export{Y as default};
