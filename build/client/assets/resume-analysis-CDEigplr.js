import{r,j as e,u as J}from"./components-BTXmr68H.js";import{C as D}from"./Card-Cg6ocORJ.js";import{B as c}from"./Button-BZG3s6SU.js";import{S as F}from"./Select-RG5OTrzS.js";import{M}from"./Modal-Cd9pgKqa.js";import{A as K}from"./Alert-DdMCfCTw.js";function B({resumes:h,jobDescriptions:p,onUpdate:d}){const[t,w]=r.useState(""),[o,I]=r.useState(""),[i,u]=r.useState(null),[j,S]=r.useState(null),[g,z]=r.useState(!1),[N,C]=r.useState(!1),[m,O]=r.useState(!1),[E,y]=r.useState(!1),[R,n]=r.useState(null),k=async s=>{const a=s||t;if(!a||!o){n("Please select both a resume and a job description");return}z(!0),n(null);try{const l=await fetch("/api/resume-analysis",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({resumeId:a,jobDescriptionId:o})}),f=await l.json();if(!l.ok)throw new Error(f.error||"Failed to analyze resume");u(f.analysis)}catch(l){n(l instanceof Error?l.message:"Failed to analyze resume"),u(null)}finally{z(!1)}},L=async()=>{if(!t||!o){n("Please select both a resume and a job description");return}C(!0),n(null);try{const s=await fetch("/api/resume-analysis/optimize",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({resumeId:t,jobDescriptionId:o})}),a=await s.json();if(!s.ok)throw new Error(a.error||"Failed to optimize resume");S(a.optimization);const l=a.optimization.formattedDocumentId;w(l),d==null||d(),await k(l),y(!0)}catch(s){n(s instanceof Error?s.message:"Failed to optimize resume"),S(null)}finally{C(!1)}},b=async s=>{var a;if(!t){n("Please select a resume");return}O(!0),n(null);try{const l=await fetch("/api/documents/export",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({documentId:t,format:s,score:i==null?void 0:i.score,analysis:i?{keywordsFound:i.analysis.keywordsFound,missingKeywords:i.analysis.missingKeywords,recommendations:i.recommendations,summary:i.summary}:void 0})}),f=await l.json();if(!l.ok)throw new Error(f.error||"Failed to export resume");const v=l.headers.get("Content-Disposition"),P=((a=v==null?void 0:v.split("filename=")[1])==null?void 0:a.replace(/"/g,""))||`resume.${s}`,T=await l.blob(),A=window.URL.createObjectURL(T),x=document.createElement("a");x.href=A,x.download=P,document.body.appendChild(x),x.click(),window.URL.revokeObjectURL(A),document.body.removeChild(x)}catch(l){n(l instanceof Error?l.message:"Failed to export resume")}finally{O(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(D,{variant:"bordered",className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Resume Analysis"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(F,{label:"Select Resume",value:t,onChange:s=>{w(s.target.value),u(null),n(null)},options:[{value:"",label:"Select a resume..."},...h.map(s=>({value:s.id,label:s.name}))]}),e.jsx(F,{label:"Select Job Description",value:o,onChange:s=>{I(s.target.value),u(null),n(null)},options:[{value:"",label:"Select a job description..."},...p.map(s=>({value:s.id,label:s.name}))]})]}),R&&e.jsx("div",{className:"mt-4",children:e.jsx(K,{variant:"error",onClose:()=>n(null),children:R})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-4",children:[e.jsx(c,{onClick:()=>k(),isLoading:g,disabled:!t||!o||g,children:g?"Analyzing...":"Analyze Resume"}),i&&i.score<90&&e.jsx(c,{onClick:L,isLoading:N,variant:"secondary",disabled:!t||!o||N,children:N?"Optimizing...":"Optimize Resume"}),t&&i&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:()=>b("txt"),isLoading:m,variant:"secondary",disabled:!t||m,children:"Export TXT"}),e.jsx(c,{onClick:()=>b("pdf"),isLoading:m,variant:"secondary",disabled:!t||m,children:"Export PDF"}),e.jsx(c,{onClick:()=>b("docx"),isLoading:m,variant:"secondary",disabled:!t||m,children:"Export DOCX"})]})]})]}),i&&e.jsx(D,{variant:"bordered",className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Overall Score"}),e.jsxs("div",{className:`text-3xl font-bold ${i.score>=90?"text-green-600":"text-blue-600"}`,children:[i.score,"%"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Score Breakdown"}),e.jsx("div",{className:"space-y-2",children:Object.entries(i.criteriaScores).map(([s,a])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"capitalize",children:s.replace(/([A-Z])/g," $1").trim()}),e.jsxs("span",{className:"font-semibold",children:[a,"%"]})]},s))})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Keywords Found"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.analysis.keywordsFound.map((s,a)=>e.jsx("li",{className:"text-green-600",children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Missing Keywords"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.analysis.missingKeywords.map((s,a)=>e.jsx("li",{className:"text-red-600",children:s},a))})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Strengths"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.analysis.strengths.map((s,a)=>e.jsx("li",{className:"text-green-600",children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Weaknesses"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:i.analysis.weaknesses.map((s,a)=>e.jsx("li",{className:"text-red-600",children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Recommendations"}),e.jsx("ul",{className:"list-disc list-inside space-y-2",children:i.recommendations.map((s,a)=>e.jsx("li",{children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Summary"}),e.jsx("p",{className:"text-gray-700",children:i.summary})]})]})}),E&&j&&e.jsx(M,{isOpen:E,onClose:()=>y(!1),title:"Optimized Resume",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Expected Score"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:[j.expectedScore,"%"]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Changes Made"}),e.jsx("ul",{className:"list-disc list-inside space-y-2",children:j.changes.map((s,a)=>e.jsx("li",{children:s},a))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Optimized Content"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg max-h-96 overflow-y-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm",children:j.optimizedContent})})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx(c,{variant:"secondary",onClick:()=>y(!1),children:"Close"}),e.jsx(c,{onClick:()=>{y(!1),b("docx")},children:"Export DOCX"})]})]})})]})}function H(){const{resumes:h,jobDescriptions:p,error:d}=J();return d?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),e.jsx("p",{className:"text-gray-600",children:d})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Resume Analysis"}),h.length===0||p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Documents Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Please upload at least one resume and one job description to use this feature."}),e.jsx("a",{href:"/documents",className:"text-blue-600 hover:text-blue-700",children:"Go to Documents â†’"})]}):e.jsx(B,{resumes:h,jobDescriptions:p})]})}export{H as default};
