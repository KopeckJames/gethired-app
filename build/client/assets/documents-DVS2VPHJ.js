import{b as k,r as i,u as A,c as P,j as e}from"./components-BTXmr68H.js";import{C as T}from"./Card-Cg6ocORJ.js";import{B as d}from"./Button-BZG3s6SU.js";import{I as O}from"./Input-8y3g3GgE.js";import{S as R}from"./Select-RG5OTrzS.js";import{M as N}from"./Modal-Cd9pgKqa.js";import{A as D}from"./Alert-DdMCfCTw.js";import{E as I}from"./EmptyState-XxnvsSZc.js";import{u as L}from"./AuthContext-BrU48O4c.js";function M(){const{user:u,isAuthenticated:m}=L(),s=k();return i.useEffect(()=>{u||s("/?error=Please%20log%20in%20to%20continue")},[u,s]),async(h,l)=>{try{if(!m)throw s("/?error=Please%20log%20in%20to%20continue"),new Error("Not authenticated");const o=await fetch(h,{...l,credentials:"include",headers:{...l==null?void 0:l.headers,Accept:"application/json"}});if(o.status===401)throw s("/?error=Session%20expired.%20Please%20log%20in%20again"),new Error("Unauthorized");return o}catch(o){throw o instanceof Error&&o.message==="Not authenticated"?o:(console.error("Request failed:",o),new Error("Failed to make request"))}}}function H(){const{documents:u,error:m}=A(),[s,h]=i.useState(null),[l,o]=i.useState(!1),[w,b]=i.useState("resume"),[C,p]=i.useState(!1),[f,r]=i.useState(null),[j,x]=i.useState(null),c=i.useRef(null),g=P(),y=M();if(m)return e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),e.jsx("p",{className:"text-gray-600",children:m})]})});const E=t=>{var n;const a=(n=t.target.files)==null?void 0:n[0];a&&(x(a),r(null))},S=async()=>{if(!j){r("Please select a file");return}o(!0),r(null);const t=new FormData;t.append("file",j),t.append("type",w);try{const a=await y("/api/documents/upload",{method:"POST",body:t});if(!a.ok){const v=await a.json();throw new Error(v.error||"Failed to upload document")}const n=await a.json();c.current&&(c.current.value=""),x(null),p(!1),g.revalidate()}catch(a){r(a instanceof Error?a.message:"Failed to upload document")}finally{o(!1)}},F=async t=>{try{const a=await y(`/api/documents/${t}`,{method:"DELETE"});if(!a.ok){const v=await a.json();throw new Error(v.error||"Failed to delete document")}const n=await a.json();n.success?g.revalidate():r(n.error||"Failed to delete document")}catch(a){r(a instanceof Error?a.message:"Failed to delete document")}},U=(t,a)=>{try{const n=atob(t);return a==="application/pdf"?e.jsx("iframe",{src:`data:application/pdf;base64,${t}`,className:"w-full h-[60vh]",title:"PDF Document"}):e.jsx("pre",{className:"whitespace-pre-wrap",children:n})}catch{return e.jsx("pre",{className:"whitespace-pre-wrap",children:t})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Documents"}),e.jsx(d,{onClick:()=>p(!0),children:"Upload Document"})]}),f&&e.jsx(D,{variant:"error",onClose:()=>r(null),children:f}),u.length===0?e.jsx(I,{title:"No documents",description:"Upload your first document to get started",action:e.jsx(d,{onClick:()=>p(!0),children:"Upload Document"})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:u.map(t=>e.jsx(T,{variant:"bordered",className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:t.type}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(t.uploadedAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"secondary",onClick:()=>h(t),children:"View"}),e.jsx(d,{variant:"outline",onClick:()=>{window.confirm("Are you sure you want to delete this document?")&&F(t.id)},children:"Delete"})]})]})},t.id))}),e.jsx(N,{isOpen:C,onClose:()=>{p(!1),x(null),r(null),c.current&&(c.current.value="")},title:"Upload Document",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{label:"Document Type",value:w,onChange:t=>b(t.target.value),options:[{value:"resume",label:"Resume"},{value:"job_description",label:"Job Description"},{value:"cover_letter",label:"Cover Letter"},{value:"other",label:"Other"}]}),e.jsx(O,{ref:c,type:"file",accept:".pdf,.doc,.docx,.txt",onChange:E,disabled:l}),e.jsx("p",{className:"text-sm text-gray-500",children:"Supported formats: PDF, DOC, DOCX, TXT"}),f&&e.jsx(D,{variant:"error",onClose:()=>r(null),children:f}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>{p(!1),x(null),r(null),c.current&&(c.current.value="")},disabled:l,children:"Cancel"}),e.jsx(d,{onClick:S,disabled:!j||l,children:l?"Uploading...":"Upload"})]})]})}),e.jsx(N,{isOpen:!!s,onClose:()=>{h(null),r(null)},title:(s==null?void 0:s.name)??"",children:e.jsx("div",{className:"max-h-[60vh] overflow-y-auto",children:s&&U(s.content,s.type)})})]})}export{H as default};
